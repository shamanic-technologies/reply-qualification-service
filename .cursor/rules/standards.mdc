---
description: Standards pour reply-qualification-service
alwaysApply: true
---

# Standards

## Database

JAMAIS exécuter de SQL direct via Neon MCP. Utiliser `npm run db:push`.

Après modification de schema:
1. Mettre à jour `tests/helpers/test-db.ts`
2. Mettre à jour `tests/integration/db.test.ts`
3. `npm test` localement
4. `npm run db:push`
5. Commit + push

## Indexes

```typescript
// ✅ Performance
index("idx_requests_org").on(table.sourceOrgId)

// ✅ Contrainte unique
uniqueIndex("idx_unique_field").on(table.uniqueField)

// ❌ Erreur
uniqueIndex sur un champ non-unique
```

## Tests

```typescript
// vitest.config.ts obligatoire
fileParallelism: false,
maxWorkers: 1,
```

## Workflow

1. Lire schema + tests existants
2. Modifier schema.ts
3. Modifier tests
4. `npm test`
5. `npm run db:push`
6. Commit + push
7. Demander redeploy
