---
description: Development standards for reply-qualification-service
alwaysApply: true
---

# Standards

## Database

NEVER run SQL directly via Neon MCP. Use `npm run db:push`.

After schema modification:
1. Update `tests/helpers/test-db.ts`
2. Update `tests/integration/db.test.ts`
3. `npm test` locally
4. `npm run db:push`
5. Commit + push

## Indexes

```typescript
// ✅ Performance
index("idx_requests_org").on(table.sourceOrgId)

// ✅ Unique constraint
uniqueIndex("idx_unique_field").on(table.uniqueField)

// ❌ Mistake
uniqueIndex on a non-unique field
```

## Tests

```typescript
// vitest.config.ts required
fileParallelism: false,
maxWorkers: 1,
```

## Workflow

1. Read existing schema + tests
2. Modify schema.ts
3. Modify tests
4. `npm test`
5. `npm run db:push`
6. Commit + push
7. Ask for redeploy
